<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magdalena Bay Song Tournament</title>

<style>
  body {
    background-color: #f3f4f6;
    margin: 0;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    padding: 10px;
    font-size: 20px;
  }

  h1 {
    margin-bottom: 20px;
    text-align: center;
  }

  #battleNumber {
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
  }

  #progress-container {
    width: 80%;
    max-width: 600px;
    background: #ddd;
    border-radius: 8px;
    height: 25px;
    position: relative;
    margin-bottom: 20px;
  }

  #progressBar {
    background: #4caf50;
    height: 100%;
    width: 0%;
    border-radius: 8px;
    transition: width 0.3s;
    position: relative;
  }

  #progressPercent {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    text-align: center;
    line-height: 25px;
    font-weight: bold;
    color: white;
  }

  #choices {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
    flex-wrap: nowrap;
  }

  .song-card {
    background-color: #fff;
    border: 3px solid #ccc;
    border-radius: 10px;
    width: 45vw;       /* responsive width */
    max-width: 420px;  /* cap at 420px */
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.1s;
  }
  .song-card:hover { transform: scale(1.03); }

  .song-card img {
    width: 100%;
    height: auto;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 12px;
  }

  .song-card p {
    font-size: 1.2rem;
    font-weight: 600;
    text-align: center;
    margin: 0;
  }

  #result {
    margin-top: 30px;
    text-align: center;
    display: none;
  }

  #ranking {
    margin-top: 10px;
    text-align: left;
    display: inline-block;
  }
</style>
</head>
<body>
  <h1>Magdalena Bay Song Tournament</h1>
  <div id="battleNumber">Battle 1</div>

  <div id="progress-container">
    <div id="progressBar"><span id="progressPercent">0%</span></div>
  </div>

  <div id="choices">
    <div class="song-card" id="left" onclick="choose('left')">
      <img id="leftImg" src="" alt="Left Song">
      <p id="leftName"></p>
    </div>
    <div class="song-card" id="right" onclick="choose('right')">
      <img id="rightImg" src="" alt="Right Song">
      <p id="rightName"></p>
    </div>
  </div>

  <div id="result">
    <h2>Final Ranking</h2>
    <ol id="ranking"></ol>
  </div>

<script>
const songs = [
  { name: "Death & Romance", image: "images/death-romance.jpeg" },
  { name: "Tunnel Vision", image: "images/tunnel-vision.jpeg" },
  { name: "Second Sleep", image: "images/second-sleep-star-eyes.jpeg" },
  { name: "Star Eyes", image: "images/second-sleep-star-eyes.jpeg" },
  { name: "Human Happens", image: "images/human-happens-paint-me-a-picture.jpeg" },
  { name: "Paint Me a Picture", image: "images/human-happens-paint-me-a-picture.jpeg" }
];

// Shuffle songs
songs.sort(() => Math.random() - 0.5);

// Tournament state
let lists = songs.map(s => [s]);
let currentMergeQueue = [];
let currentMerge = null;
let head1 = 0, head2 = 0;
let rec = [];
let numQuestion = 1;

// Progress
let totalComparisons = Math.pow(songs.length,2)/2;
let comparisonsLeft = totalComparisons;

// --- Update progress bar ---
function updateProgress() {
  const bar = document.getElementById("progressBar");
  const percentText = document.getElementById("progressPercent");
  const percent = Math.floor(((totalComparisons - comparisonsLeft)/totalComparisons)*100);
  bar.style.width = percent + "%";
  percentText.textContent = percent + "%";
}

// --- Show images ---
function showImage() {
  if (!currentMerge) return;
  document.getElementById("battleNumber").textContent = `Battle ${numQuestion}`;
  document.getElementById("leftImg").src = currentMerge.left[head1].image;
  document.getElementById("leftName").textContent = currentMerge.left[head1].name;
  document.getElementById("rightImg").src = currentMerge.right[head2].image;
  document.getElementById("rightName").textContent = currentMerge.right[head2].name;
}

// --- Choose song ---
function choose(side) {
  if (!currentMerge) return;

  rec.push(side==="left"?currentMerge.left[head1++]:currentMerge.right[head2++]);
  numQuestion++;
  comparisonsLeft--;

  while(head1<currentMerge.left.length && head2===currentMerge.right.length) rec.push(currentMerge.left[head1++]);
  while(head2<currentMerge.right.length && head1===currentMerge.left.length) rec.push(currentMerge.right[head2++]);

  if(head1===currentMerge.left.length && head2===currentMerge.right.length){
    currentMerge.merged.push(...rec);
    rec = [];
    prepareNextMerge();
  } else {
    showImage();
  }

  updateProgress();
  if(comparisonsLeft<=0) document.removeEventListener("keydown", keyListener);
}

// --- Next merge ---
function prepareNextMerge(){
  if(currentMergeQueue.length>0){
    currentMerge = currentMergeQueue.shift();
    head1=0; head2=0;
    showImage();
  } else {
    prepareNextRound();
  }
}

// --- Next round ---
function prepareNextRound(){
  let newLists = [];
  currentMergeQueue = [];

  while(lists.length>0){
    const left = lists.shift();
    const right = lists.shift();
    const merged = [];
    if(right){
      currentMergeQueue.push({left,right,merged});
      newLists.push(merged);
    } else {
      newLists.push(left);
    }
  }

  lists = newLists;

  if(currentMergeQueue.length>0){
    currentMerge = currentMergeQueue.shift();
    head1=0; head2=0; rec=[];
    showImage();
  } else {
    showResult();
  }
}

// --- Show final ranking ---
function showResult(){
  document.getElementById("choices").style.display = "none";
  const resultDiv = document.getElementById("result");
  resultDiv.style.display = "block";
  const rankingList = document.getElementById("ranking");
  lists[0].forEach(song=>{
    const li = document.createElement("li");
    li.textContent = song.name;
    rankingList.appendChild(li);
  });
}

// --- Keyboard listener ---
function keyListener(e){
  if(comparisonsLeft<=0) return;
  if(e.key==="ArrowLeft") choose("left");
  if(e.key==="ArrowRight") choose("right");
}
document.addEventListener("keydown", keyListener);

// Start tournament
prepareNextRound();
updateProgress();
</script>

</html>
