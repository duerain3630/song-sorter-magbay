<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Song Sorter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #mainTable {
      margin: auto;
      border-collapse: collapse;
    }
    td {
      padding: 15px;
      border: 1px solid #ccc;
      min-width: 150px;
    }
    .middleField {
      background: #eee;
      cursor: pointer;
      font-weight: bold;
    }
    #resultField {
      margin-top: 30px;
    }
    table.result {
      margin: auto;
      border-collapse: collapse;
      font-size: 16px;
    }
    table.result td {
      border: 1px solid #000;
      padding: 5px 10px;
    }
    table.result th {
      background: #333;
      color: #fff;
      padding: 5px 10px;
    }
  </style>
</head>
<body>

<h2>Silent Hill Song Sorter</h2>
<p>Pick the song you like better in each match-up to get a ranked list.</p>

<table id="mainTable">
  <tr>
    <td colspan="3" id="battleNumber">Battle #1<br>0% sorted.</td>
  </tr>
  <tr>
  <button id="left" class="px-4 py-2 bg-blue-500 text-white rounded-lg">Left</button>
  <button id="right" class="px-4 py-2 bg-green-500 text-white rounded-lg">Right</button>
  </tr>
  <tr>
    <td></td>
    <td class="middleField" onclick="sortList(-2)">No opinion</td>
    <td></td>
  </tr>
</table>

<div id="resultField"></div>

<script>
// === SONG LIST ===
// Edit this array to add/remove songs
var namMember = [
  "Theme of Laura",
  "Promise",
  "Love Psalm",
  "You're Not Here",
  "Angel's Thanatos"
];

// === Sorter logic (unchanged from bias sorter) ===
var lstMember = [];
var parent = [];
var equal = [];
var rec = [];
var cmp1,cmp2;
var head1,head2;
var nrec;
var numQuestion;
var totalSize;
var finishSize;
var finishFlag;

function initList(){
  var n = 0;
  var mid;
  var i;
  lstMember[n] = [];
  for (i=0; i<namMember.length; i++) {
    lstMember[n][i] = i;
  }
  parent[n] = -1;
  totalSize = 0;
  n++;
  for (i=0; i<lstMember.length; i++) {
    if(lstMember[i].length>=2) {
      mid = Math.ceil(lstMember[i].length/2);
      lstMember[n] = lstMember[i].slice(0,mid);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
      lstMember[n] = lstMember[i].slice(mid,lstMember[i].length);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
    }
  }
  for (i=0; i<namMember.length; i++) {
    rec[i] = 0;
  }
  nrec = 0;
  for (i=0; i<=namMember.length; i++) {
    equal[i] = -1;
  }
  cmp1 = lstMember.length-2;
  cmp2 = lstMember.length-1;
  head1 = 0;
  head2 = 0;
  numQuestion = 1;
  finishSize = 0;
  finishFlag = 0;
}

function sortList(flag){
  var i;
  var str;
  if (flag<0) {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec-1]]!=-1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  }
  else if (flag>0) {
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec-1]]!=-1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }
  else {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec-1]]!=-1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
    equal[rec[nrec-1]] = lstMember[cmp2][head2];
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;
    while (equal[rec[nrec-1]]!=-1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }
  if (head1<lstMember[cmp1].length && head2==lstMember[cmp2].length) {
    while (head1<lstMember[cmp1].length){
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  }
  else if (head1==lstMember[cmp1].length && head2<lstMember[cmp2].length) {
    while (head2<lstMember[cmp2].length){
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }
  if (head1==lstMember[cmp1].length && head2==lstMember[cmp2].length) {
    for (i=0; i<lstMember[cmp1].length+lstMember[cmp2].length; i++) {
      lstMember[parent[cmp1]][i] = rec[i];
    }
    lstMember.pop();
    lstMember.pop();
    cmp1 = cmp1-2;
    cmp2 = cmp2-2;
    head1 = 0;
    head2 = 0;
    if (head1==0 && head2==0) {
      for (i=0; i<namMember.length; i++) {
        rec[i] = 0;
      }
      nrec = 0;
    }
  }
  if (cmp1<0) {
    str = "Battle #"+(numQuestion-1)+"<br>"+Math.floor(finishSize*100/totalSize)+"% sorted.";
    document.getElementById("battleNumber").innerHTML = str;
    showResult();
    finishFlag = 1;
  }
  else {
    showImage();
  }
}

function showResult() {
  var ranking = 1;
  var sameRank = 1;
  var str = "";
  var i;
  str += "<table class='result'>";
  str += "<tr><th>Rank</th><th>Song</th></tr>";
  for (i=0; i<namMember.length; i++) {
    str += "<tr><td>"+ranking+"</td><td>"+namMember[lstMember[0][i]]+"</td></tr>";
    if (i<namMember.length-1) {
      if (equal[lstMember[0][i]]==lstMember[0][i+1]) {
        sameRank++;
      } else {
        ranking += sameRank;
        sameRank = 1;
      }
    }
  }
  str += "</table>";
  document.getElementById("resultField").innerHTML = str;
}

function showImage() {
  var str0 = "Battle #"+numQuestion+"<br>"+Math.floor(finishSize*100/totalSize)+"% sorted.";
  var str1 = ""+toNameFace(lstMember[cmp1][head1]);
  var str2 = ""+toNameFace(lstMember[cmp2][head2]);
  document.getElementById("battleNumber").innerHTML = str0;
  document.getElementById("leftField").innerHTML = str1;
  document.getElementById("rightField").innerHTML = str2;
  numQuestion++;
}

function toNameFace(n){
  return namMember[n];
}

initList();
showImage();
</script>

</body>
</html>
